# Ветка с домашним заданием "Типизация"

Проект разрабатывался с использованием NodeJS 10.

## Отчет по ДЗ

### 1. Трудоемкость перевода проекта на Typescript

В целом перевести проект на TypeScript было не очень сложно.<br>
Принцип работы типизированных языков мне знаком (TypeScript очень напоминает Java), однако на пути встретились несколько подводных камней.<br>
В основном все сложности были связаны с работой со сторонними библиотеками:<br>

- Много времени потратил на интеграцию проекта на typesciprt с prismjs. Сложность заключалась в том, что, несмотря на то, что для самого prismjs существуют типы, плагины File Highlight и Line Numbers работали некорректно. <br>
  Для File Highlight нужно было добавить типизацию, чтобы не ругался компилятор typescript и импортировать стили prismjs. <br>
  Для Line Numbers нужно было принудительно импортировать стили и js.
- Пришлось разбираться с unit-тестами, написанными на Jest для серверной части. Здесь нюанс заключался в том, что нужно было правильно прописать импорты и задать настройку jest для корректного препроцессинга файлов ts c помощью ts-jest.<br>
  В инструкции самого ts-jest почему-то не указано, что нужно отдельно прописывать transform в jest.config.js. Видимо эта настройка корректно инициализируется при запуске ts-jest:init.
- Также долго разбирался с правильными типами дженериков для ThunkAction Redux. Т.к. я использовал хуки, мне нужно было обновить стейт через вызов хука в InfoTable после того как подгружались элементы таблицы. Трудность была в том, чтобы правильно расставить типизацию, чтобы тайпскрипт понял, что dispatch возвращает Promise.

Остальные вопросы, связанные с типизацией, особых затруднений не вызвали. Думаю это отчасти связано с тем, что сам проект не слишком сложный.

### 2. Какие в процессе перевода были найдены ошибки

Никаких серьезных ошибок я в проекте не нашел. Если и были какие-то ошибки - скорее всего они были связаны с отсутствием проверки на undefined.<br>
Однако, я провел серьезный рефакторинг в классе InfoTableRow. Проводил его с помощью юнит-тестов, которые писал на TypeScript.
С учетом типизации рефакторить было чуть проще - не надо держать типы в голове.

### 3. Решение о переводе проекта на TypeScript.
Думаю, что я волью эту ветку в мастер. После добавления TypeScript появилось чуть больше уверенности в надежности приложения. И, думаю, что стороннему наблюдателю стало чуть проще разбираться в коде приложения. 

## Инструкция по запуску

1. Установить зависимости

   ```
   npm install
   ```

1. Запустить бэкэнд (реализован на Express)

   ```
   npm run start:backend <путь до корня репозитория>
   ```

1. Запустить сервер фронта (запустится webpack-dev-server)

   ```
   npm run start:ui
   ```

### Просмотр результатов

Перейти по ссылке http://localhost:8000/.<br>
В таблице отобразятся только те папки, внутри которых находится Git-репозиторий.

### Расположение исходников

|             Директория | Описание                    |
| ---------------------: | :-------------------------- |
| `src/server/server.js` | Исходники бэкэнда           |
|      `src/components/` | Исходники react-компонентов |
|           `src/store/` | Исходники хранилища redux   |

## Интеграционное тестирование

1. Написал плагин для гермионы, который должен автоматически устанавливаться с проектом из моего репозитория.<br>
   Плагин автоматически запускает сервер фронта и бекенд-заглушку.<br>
   На всякий случай прилагаю ссылку на репозиторий с плагином:<br>
   https://github.com/Muxa89/hermione-run-servers<br>
   **Плагин тестировался на Windows. Возможно, что на других системах будут возникать ошибки при окончании тестирования, связанные с неправильным завершением процесса.**
1. Фронт тестируется в паре с сервером-заглушкой.
1. Проверяются следующие сценарии:
   - Для корневой папки:
     - В таблице отображаются имена репозиториев, отправленные сервером
     - Можно перейти в папку репозитория
     - Не показывается ссылка на родительский репозиторий
   - Для папки репозитория:
     - В таблице отображаются имена папок, которые прислал сервер
     - В таблице отображается ссылка на родительский каталог
     - Если находимся в каталоге репозитория первого уровня, нажатие на ссылку на родительский каталог перенаправит браузер в корневую папку
     - Если находимся в каталоге репозитория более глубокого уровня, нажатие на ссылку на родительский каталог перенаправит браузер на один уровень выше
   - Для ссылки на файл:
     - Нажатие на имя файла уберет таблицу с файлами и откроет элемент, содержащий в себе текст файла.
       URL изменится соответствующим образом.

#### Расположение исходников

|                   Директория | Описание                     |
| ---------------------------: | :--------------------------- |
| `test/integration/hermione/` | Исходники тестового сценария |
|    `test/integration/server` | Исходники сервера-заглушки   |

#### Запуск

Интеграционное тестирование запускается командой

```
npm run test:int
```

## Модульное тестирование

1. Для тестирования основным фреймворком выбрал Jest.
1. Для всех методов NodeJS, которые взаимодействуют с ОС, были написаны заглушки, т. о. тестирование не требует наличия файлов на жестком диске.
1. Серверную часть для тестирования разбил на 3 части:
   - api - методы для получения данных с файловой системы
   - app - описание протокола сервера
   - server - начальные проверки и запуск сервера на определенном порте.
1. Логические блоки системы и связанные сценарии:
   - Получение информации из ОС (взаимодействие с GIT)
     - Получение папки .git репозитория
     - Получение списка репозиториев в корневой папке
     - Получение дерева файлов для заданных параметров
     - Получение расширенной информации о файле
     - Получение содержимого файла
   - Предоставление информации по запросу на эндпоинт
     - Обращение на корневой эндпоинт
     - Обращение на эндпоинт репозитория
     - Обращение на эндпоинт репозитория определенной ветки
     - Обращение на эндпоинт определенной ветки в определенный каталог
     - Предоставление содержимого файла

#### Расположение исходников

|         Директория | Описание                 |
| -----------------: | :----------------------- |
| `test/unit/server` | Исходники с юнит-тестами |
|   `test/unit/mock` | Исходники заглушек       |

#### Запуск

Интеграционное тестирование запускается командой

```
npm run test
```
